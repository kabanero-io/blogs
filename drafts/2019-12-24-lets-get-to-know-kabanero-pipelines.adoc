---
layout: post
title: "Let's get to know Kabanero Pipelines"
categories: blog
author_picture: https://avatars1.githubusercontent.com/u/30604461
author_github: https://github.com/dewan-ahmed
seo-title: Let's get to know Kabanero Pipelines
seo-description: This is a blog which provides an overview of Kabanero Pipelines. First half of the blog covers Kabanero Pipelines architecture and components. End to end flow of a working pipeline is discussed in the latter half.
blog_description: This is a blog which provides an overview of Kabanero Pipelines. First half of the blog covers Kabanero Pipelines architecture and components. End to end flow of a working pipeline is discussed in the latter half.
---
Why do we need pipelines? The answer is simple - to move stuff. Whether its water sitting in reservoir or code sitting in your local machine; they're not useful to customers. We need efficient pipeline mechanism to move water (or code) and bring to your household. For software delivery, a new revolution has started after the birth and widespread of Kubernetes. Developers are no longer relying on a single Jenkins instance with hundreds of plug-ins loaded. Rather, they're opting for modular cloud-native CI/CD engines which provide reusable pieces of pipeline. Kabanero Pipelines is based on link:https://github.com/tektoncd/pipeline/tree/master/docs#usage[Tekton Pipelines] which is a Kubernetes-native CI/CD engine. 

== Components of Kabanero Pipelines

Each Kabanero collection contains  a set of default tasks and pipelines that are created when the collection is built. A Kabanero task (usually) has one particular objective e.g. to build the project or to push the image etc. A Kabanero Pipeline, on the other hand, is consists of multiple tasks; to support a more complex and end-to-end scenario. The collections build process copies the task and pipeline files from link:https://github.com/kabanero-io/collections/tree/master/incubator/common/pipelines/default[the collections repo]. If you are building a new collection, the default tasks and pipelines are automatically pulled into your collections repo. If you want to customize the default tasks or pipelines to meet your needs, you can choose to apply your changes either to all collections or to a specific collection.  


== Process of running your first Kabanero Pipeline

While there are two ways of running your Kabanero Pipeline, link:https://github.com/tektoncd/experimental/blob/master/webhooks-extension/docs/GettingStarted.md[using Automated Webhooks] is the preferred one. 

To bein with, you'll need to have link:https://github.com/kabanero-io/kabanero-foundation[Kabanero foundation installed] on Red Hat Origin Community Distribution of Kubernetes (OKD) or OpenShift Container Platform (OCP) cluster. link:https://github.com/kabanero-io/kabanero-pipelines[create a persistent volume], create secrets to pull from git repo and push to docker registry link:https://github.com/kabanero-io/kabanero-pipelines[following this link] and finally, execute pipelines using linl:https://github.com/tektoncd/experimental/blob/master/webhooks-extension/docs/GettingStarted.md[Tekton Dashboard Webhook Extension].

== Disection of a pipeline.yaml file

Following is the yaml definition of an end-to-end Kabanero Pipeline that builds, pushes and deployes and application. Let's inspect the parts that make it.

----
#Kabanero! on activate substitute CollectionId for text 'CollectionId'
apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: CollectionId-build-push-deploy-pipeline
spec:
  params:
  - name: event-headers
    type: string
    description: "The event headers"
  resources:
  - name: git-source
    type: git
  - name: docker-image
    type: image
  tasks:
  - name: build-push-deploy-task
    taskRef:
      name: CollectionId-build-push-deploy-task
    resources:
      inputs:
      - name: git-source
        resource: git-source
      outputs:
      - name: docker-image
        resource: docker-image
  - name: image-scan-task
    taskRef:
      name: CollectionId-image-scan-task
    runAfter: [build-push-deploy-task]
    resources:
      inputs:
      - name: git-source
        resource: git-source
      - name: docker-image
        resource: docker-image
----

As Kabanero Pipelines are based on Tekton resources, the *apiVersion* reflects to that of Tekton and *kind* points to a Kubernetes Custom  Resource Definition (CRD) of type Pipeline. *Metadata* tags the the unique name of this resource. What interestes us is *spec* which contains *params* (to inject various parameters), *resources* (to indicate the source and destination resources the pipeline will use) and *tasks* that is made up of the most basic building blocks of pipelines. This pipeline uses a git-source to fetch the application code and a docker registry to push the image built from the source. This is defined under *resources*. Specifics of those resources are found under each *tasks*. 

== Monitoring your pipeline

You have three ways to monitor your pipelines:

. OKD/OpenShift console
. Command line
. Tekton dashboard

To check status of your pipelines from OKD/OpenShift console, log in from *developer* perspective and click on *Pipelines*:

image::/img/blog/kabanero-pipelines.jpg[link="/img/blog/kabanero-pipelines.jpg.jpg" alt="Monitoring your Kabanero Pipelines from "]

To check pipeline run status from the Tekton dashboard, login to the Tekton Dashboard and click *Pipeline runs* in the sidebar menu. Find your pipeline run in the list and click it to check the status and find logs. You can see logs and status of each step and task.

You can also monitor pipeline run status from the command line. Enter the following command in the terminal:
----
oc get pipelineruns
oc -n kabanero describe pipelinerun.tekton.dev/<pipeline-run-name>
----

If you're looking to troubleshoot, refer to link:https://github.com/kabanero-io/kabanero-pipelines/blob/master/Troubleshooting.md[Kabanero Pipelines Troubleshooting Guide].
